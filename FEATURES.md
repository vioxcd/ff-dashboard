# Features

## Done

|           | Feature                                                                                                                   | Status | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|:---------:|---------------------------------------------------------------------------------------------------------------------------|:------:|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|    API    | Fetch `progress`                                                                                                          |    ‚úÖÔ∏è   | Needed for rules                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|    API    | Fetch media `scores`                                                                                                      |    ‚úÖÔ∏è   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|    API    | Fetch `rewatch` count                                                                                                     |    ‚ùåÔ∏è   | Not many people track their rewatches                                                                                                                                                                                                                                                                                                                                                                                                                               |
|    API    | Fetch all image types for various layout uses                                                                             |    ‚úÖÔ∏è   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|    API    | Fetch several missing fields for FF's AOTY                                                                                |    ‚úÖÔ∏è   | Missing: relationType (non sequel), source, and format                                                                                                                                                                                                                                                                                                                                                                                                              |
|    API    | Fetch tags / genre / studio media data for extra analysis                                                                 |    üí≠Ô∏è   | There should be a bridge table for media-tags  Rethink: use `statistics` connection from the API instead of fetching things myself                                                                                                                                                                                                                                                                                                                                  |
|    API    | Fetch things for favorites analysis                                                                                       |    ‚úÖÔ∏è   | Anime, manga, chara, staff, and studio; only name and pictures                                                                                                                                                                                                                                                                                                                                                                                                      |
|    API    | Use the user's `statistics` from the API for better stats representation                                                  |    ‚ùåÔ∏è   | This would mean including ALL titles from the user (not only `as_rules`)                                                                                                                                                                                                                                                                                                                                                                                            |
|    Data   | Implement fluff's rules                                                                                                   |    ‚úÖÔ∏è   | Rules' detail in README                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|    Data   | AOTY should take into account when the series is completed                                                                |    ‚ùåÔ∏è   | Some members' Anilist' `completedAt` property have `null` values, even though they've completed the series (probably bug from Anilist)                                                                                                                                                                                                                                                                                                                              |
|    Data   | Favorites take items in > .9 percentile                                                                                   |    ‚úÖ   | Only counting stuff. Uses `PERCENT_RANK` sql statement to pick top items.                                                                                                                                                                                                                                                                                                                                                                                           |
|    Data   | Anichan score can't be "inferred" from the normal score. (needs to fetch additional `score (format: POINT_100)` from API) |    ‚ùåÔ∏è   | Example: wi uses `POINT_100` format before switching to `POINT_5`, and somehow his score is still recorded as 100 instead of 90 (e.g. in Madoka Magica)                                                                                                                                                                                                                                                                                                             |
|    Data   | Creates mapping view from `anichan_score` to normal "point" score                                                         |    ‚ùìÔ∏è   | Point scores have known and non-random mapping, so it's easier to convert to it first from `anichan_score`, and then convert to the appropriate score  This way, `anichan_score` can be the ones being fetched, because it's mapping to score are now entirely known                                                                                                                                                                                                |
|    Data   | Translate "buggy users" score to its correct format                                                                       |    ‚úÖ   | It's quite easy to adjust the score with `POINT_10_DECIMAL` or `POINT_10` format to its correct form.  But, I think I **need to rethink this**, as I'm currently adjusting/fixing the data that are quick to fetch rather than adjusting/fixing the slower-to-fetch data.  Possible solution: see the `mapping` view again, and start from there to convert `anichan_score` (quick but buggy) to its correct score (slow but correct) for the *actually slow* users |
|    Data   | AOTY views                                                                                                                |    ‚úÖ   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|    Data   | Wide view for media and tags                                                                                              |    ‚úÖ   | The basis for tags statistics variation                                                                                                                                                                                                                                                                                                                                                                                                                             |
|    Data   | Media stddev view (what's the most divisive series?)                                                                      |    ‚úÖ   | Taken from `as_rules` (FF score comparison - differed from `underrated` which taken from AL score comparison)                                                                                                                                                                                                                                                                                                                                                       |
|    Data   | Low rating-but loved series                                                                                               |    ‚ùåÔ∏è   | Too much data to fetch (5000s)                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|    Data   | Underrated views                                                                                                          |    ‚úÖ   | Uses AL score as comparison (to decide what's "underrated")                                                                                                                                                                                                                                                                                                                                                                                                         |
|    Data   | Studios statistics views                                                                                                  |    ‚úÖ   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|    Data   | Tags & subcategory statistics views                                                                                       |    ‚úÖ   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Dashboard | Implement layout as in design                                                                                             |    ‚úÖ   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Dashboard | Anime and Manga tab                                                                                                       |    ‚úÖ   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Dashboard | Include media with rating below 85                                                                                        |    ‚ùåÔ∏è   | As there's no conditional rendering in tabs, all data/images included will result in slower page load. Stick to 85+ for now                                                                                                                                                                                                                                                                                                                                         |
| Dashboard | Includes media with score more than 85 in either anichan score or ff score                                                |    ‚úÖ   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Dashboard | Toggle `anichan_score` and adjusted `ff_score`                                                                            |    ‚ùåÔ∏è   | Cancelled. The formats are changed to row-based instead of image-based                                                                                                                                                                                                                                                                                                                                                                                              |
| Dashboard | AOTY tabs                                                                                                                 |    ‚úÖ   | AOTY looks like Hall of Fame                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Dashboard | Rating Sections UI for Anime and Manga                                                                                    |    ‚úÖ   | Divide ratings between media into gold, silver, and bronze. Uses streamlit's expander                                                                                                                                                                                                                                                                                                                                                                               |
| Dashboard | Favorites tab                                                                                                             |    ‚ùóÔ∏è   | Ranking uses its own logic and not the ones from SQL (**move this part to SQL**)                                                                                                                                                                                                                                                                                                                                                                                    |
|    Bug    | API call uses `username` to identify users, but `username` can change                                                     |    ‚úÖ   | Track user via their IDs instead                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|    Bug    | AOTY's best movie category takes into account `ONA` format with one episode                                               |    ‚úÖ   | Fetch media `episodes` data and use that in filter                                                                                                                                                                                                                                                                                                                                                                                                                  |
|    Bug    | Properly formatted score for `anichan_score` only work for 1-per-page fetches                                             |    ‚úÖ   | Users score whose `score_format` are `POINT_5` or `POINT_3` gets "overwritten" when fetched alongside `score(format: POINT_100)` To circumvent this, each media score must be fetched one per page (the current default is 50 per page). So, it's not "batched" anymore                                                                                                                                                                                             |
|    Bug    | Came across a "circular view reference" bug in `v_appropriate_score`, `v_buggy_users`, and `v_lists`                      |    ‚úÖ   | Solved by adding columns to associated table, e.g. adding `is_buggy` to `users` instead of creating `v_buggy_users`; doing `UPDATE` on buggy `score` instead of creating `v_lists`.  The question that left now is whether modifying source table is regarded as good practice.                                                                                                                                                                                     |
|    Bug    | Handle case of `user not found` error from the API                                                                        |    ‚úÖ   | This happens when an account is either deleted or is private                                                                                                                                                                                                                                                                                                                                                                                                        |
|    Bug    | Fetching only one media tags `ranks`. Also wrong `ranks` placement                                                        |    ‚úÖ   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|   Tools   | Rate-limiter library                                                                                                      |    ‚úÖ   | [PyrateLimiter](https://github.com/vutran1710/PyrateLimiter). A bit tricky to get right at first                                                                                                                                                                                                                                                                                                                                                                    |
|   Tools   | Use logging                                                                                                               |    ‚úÖ   | Better error detection this way rather than printing or redirection                                                                                                                                                                                                                                                                                                                                                                                                 |

## TODOs

- [Refactor] Planning to run this for the whole year ‚Äî think about how to model historical data (lineage?) and its management
- [Refactor] Create object models (class and abstract class?) for every `table create` and `save` method
- [Refactor] use dbt-like data transformation progression. e.g. do not touch the source data (like doing `ALTER ADD` and `UPDATE` in my case) and try to work with staging and intermediate layers (my appropriate_score is currently used to detect bugs, but it could've been separated in bug discovery case vs. actually transforming the score)
- [Tidy] Source API use `score` (singular), but somehow I use `scores` (plural) as column name
- [Upgrade] use ORM to handle table creation and data insertion
- [Upgrade] use dbt to handle SQLs and view re-creation
- [Upgrade] add logging
- [Upgrade] add Airflow to orchestrate data fetch. (add scenario to account for slower data fetch in a more streamlined fashion, e.g. fetch initially, but only fetch when `score_format` of each user changes -- this means detecting the change in `score_format` before fetching data)
- [Upgrade] Add data tests
- [Upgrade] Add API tests
- [Upgrade] Add data access to google sheets (easier to share for people -- server's admin)
- Refactor apps to its own folder and file structures (separate it with data fetching routine)
- Download all used images in local
- Redirect to page on link click
- Various way to sort and filter (sort by: most watched, most favorited, most rewatched count. fetch accordingly)
- Track score changes overtime and display who contributed to the change
- Similarity profile between members
